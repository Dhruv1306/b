<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
      }

      .navbar {
        background-color: #2c3e50;
        color: #fff;
        padding: 1rem 2rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .navbar .logo {
        font-weight: bold;
        font-size: 1.2rem;
      }

      .navbar .username {
        background: #34495e;
        padding: 0.5rem 1rem;
        border-radius: 20px;
      }

      .dashboard-content {
        padding: 2rem;
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <div class="logo">Dashboard</div>
      <div id="username"></div>
      <!--A Placeholder element for my username  // Also note, that the script replaces the entire content of the <div> with "Welcome..." -->
    </nav>

    <div class="dashboard-content">
      <h2>Admin Panel: Active Sessions</h2>
      <table border="1" cellpadding="6">
        <thead>
          <tr>
            <th>Username</th>
            <th>Login Time</th>
            <th>Session Expiration</th>
            <th>Role</th>
          </tr>
        </thead>
        <tbody>
          <!-- Dynamic rows will be inserted here by JS -->
        </tbody>
      </table>
      <br />
      <a href="/dashboard/admin">Back to Dashboard</a>
      <a href="/logout" style="margin-left: 20px">Logout</a>
    </div>

    <script>
      // Set username from path  ( If we are passing PATH Parameters in the URL during "res.redirect('/dashboard/....')"
      const pathParts = location.pathname.split("/").pop();
      const userName = decodeURIComponent(pathParts);
      document.getElementById("username").textContent = `Welcome, ${userName || "Guest"}`;

      // Fetch active sessions and populate table
      fetch('/api/sessions')
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('tbody');
          tbody.innerHTML = '';
          data.forEach(s => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
              <td>${s.username}</td>
              <td>${new Date(s.loginTime).toLocaleString()}</td>
              <td>${s.expiresAt ? new Date(s.expiresAt).toLocaleString() : '-'}</td>
              <td>${s.role}</td>
            `;
            tbody.appendChild(tr);
          });
        });
    </script>

    <!-- <script>        // This script works, if we are passing QUERY PARAMETERS(query) in the URL during "res.redirect('/dashboard/....')"
        document.getElementById('username').textContent = decodeURIComponent(new URLSearchParams(location.search).get('name') || 'Guest');
    </script> -->
  </body>
</html>

<!-- ".pop()" removes and returns the last item in the array â€” which is exactly what you want: the username. -->