<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/styles.css" rel="stylesheet">
    <link href="/header.css" rel="stylesheet">
    <link href="/footer.css" rel="stylesheet">
    <script src="/header.js" defer></script>
    <script src="/footer.js" defer></script>
  </head>
  <body>
    <!-- Include Header -->
    <%- include('partials/header') %>
    
    <div class="container">
      <div class="content">
        <!-- Add Student Section -->
        <div class="form-section">
          <h2><i class="fas fa-user-plus"></i> Add New Student</h2>
          <form action="/add-student" method="POST">
            <div class="form-row">
              <div class="form-group">
                <label for="name"><i class="fas fa-user"></i> Full Name</label>
                <input type="text" id="name" name="name" placeholder="Enter student name" required />
              </div>
              <div class="form-group">
                <label for="age"><i class="fas fa-calendar-alt"></i> Age</label>
                <input type="number" id="age" name="age" placeholder="Enter age" min="5" max="50" required />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="class"><i class="fas fa-chalkboard"></i> Class</label>
                <input type="text" id="class" name="class" placeholder="Enter class (e.g., 10th Grade)" required />
              </div>
              <div class="form-group">
                <label for="marks"><i class="fas fa-chart-line"></i> Marks</label>
                <input type="number" id="marks" name="marks" placeholder="Enter marks" min="0" max="100" required />
              </div>
            </div>
            <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Add Student </button>
          </form>
        </div>

        <!-- Filter Section -->
        <div class="form-section">
          <h2><i class="fas fa-filter"></i> Filter Students</h2>
          <form action="/filter" method="POST">
            <div class="form-row">
              <div class="form-group">
                <label for="filterType"><i class="fas fa-search"></i> Filter Type</label>
                <select name="filterType" id="filterType" onchange="toggleFilterValue(this.value)" required>
                  <option value="" disabled selected>Select filter type</option>
                  <option value="minMarks">Minimum Marks</option>
                  <option value="maxMarks">Maximum Marks</option>
                  <option value="greaterThan">Greater Than</option>
                  <option value="lessThan">Less Than</option>
                  <option value="pass">Pass Students (â‰¥40)</option>
                  <option value="fail">Fail Students (<40)</option>
                </select>
              </div>
              <div class="form-group">
                <label for="filterValue"><i class="fas fa-hashtag"></i> Filter Value</label>
                <input type="number" name="filterValue" id="filterValue" placeholder="Enter filter value" />
              </div>
            </div>
            <button type="submit" class="btn btn-primary"><i class="fas fa-search"></i> Apply Filter </button>
            <a href="/" class="btn btn-secondary"><i class="fas fa-times"></i> Clear Filter </a>
          </form>
        </div>

      <script>
        function toggleFilterValue(filterType) {
          const filterValueInput = document.getElementById("filterValue");
          if (filterType === "pass" || filterType === "fail") {
            filterValueInput.style.display = "none";
            filterValueInput.required = false;
            filterValueInput.value = ""; // Clear the value
          } else {
            filterValueInput.style.display = "inline";
            filterValueInput.required = true;
          }
        }

        // Hide the input initially if no option is selected
        document.addEventListener("DOMContentLoaded", function () {
          toggleFilterValue("");
        });
      </script>
    </form>

    <br />

        <!-- Filter Applied Section -->
        <% if (appliedFilter) { %>
        <div class="filter-applied">
          <div>
            <i class="fas fa-info-circle"></i><strong>Active Filter:</strong> <%= appliedFilter %>
          </div>
          <a href="/"><i class="fas fa-times"></i> Clear</a>
        </div>
        <% } %>

        <!-- Data Table Section -->
        <div class="data-table">
          <div class="table-header">
            <h2><i class="fas fa-table"></i> Student Records</h2>
          </div>
          
          <% if (data && data.length > 0) { %>
          <table>
            <thead>
              <tr>
                <th><i class="fas fa-hashtag"></i> S.No</th>
                <th><i class="fas fa-user"></i> Name</th>
                <th><i class="fas fa-birthday-cake"></i> Age</th>
                <th><i class="fas fa-school"></i> Class</th>
                <th><i class="fas fa-trophy"></i> Marks</th>
                <th><i class="fas fa-cogs"></i> Actions</th>
              </tr>
            </thead>
            <tbody>
              <% data.forEach(student => { %>
              <tr>
                <td><%= student.index %></td>
                <td><%= student.name %></td>
                <td><%= student.age %> years</td>
                <td><%= student.class %></td>
                <td>
                  <% if (student.marks >= 40) { %>
                    <span style="color: #48bb78; font-weight: 600;"><%= student.marks %></span>
                  <% } else { %>
                    <span style="color: #e53e3e; font-weight: 600;"><%= student.marks %></span>
                  <% } %>
                </td>
                <td>
                  <a href="/edit-st/<%= student._id %>" class="action-btn btn-edit"> <i class="fas fa-edit"></i> Edit </a>
                  <a href="/delete-st/<%= student._id %>" class="action-btn btn-delete"  onclick="return confirm('Are you sure you want to delete this student?')"> <i class="fas fa-trash"></i> Delete </a>
                </td>
              </tr>
              <% }) %>
            </tbody>
          </table>
          <% } else { %>
          <div class="empty-state">
            <i class="fas fa-users-slash"></i>
            <h3>No Students Found</h3>
            <p>Add some students to get started or adjust your filter criteria.</p>
          </div>
          <% } %>
        </div>
      </div>
    </div>
    
    <!-- Include Footer -->
    <%- include('partials/footer') %>
  </body>
</html>
